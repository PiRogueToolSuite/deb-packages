#!/bin/sh

usage()
{
  echo "usage: $0 FQDN MAIL_ADDRESS"
  echo "       FQDN        : full qualified domain name of the issued certificate"
  echo "                e.g: my-machine.my-domain.net"
  echo "       MAIL_ADDRESS: a valid email address to issue a new certificate"
  echo "                e.g: john.doe@mail.net"
  exit 1
}

if test $# -ne 2
then
  usage
fi

FQDN="${1}"
MAIL_ADDRESS="${2}"

/usr/bin/certbot certonly \
  --pre-hook "service nginx stop" \
  --post-hook "service nginx start" \
  --standalone \
  -d $FQDN \
  -m $MAIL_ADDRESS \
  --agree-tos -n